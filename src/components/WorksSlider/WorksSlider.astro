---
import type { WorksList } from "@/types/microcms";
import { Image } from "astro:assets";
type Props = {
  worksList: WorksList;
};
const { worksList } = Astro.props;
---

<div class="works-slider-wrapper">
  <div
    id="works-slider"
    class="splide works-slider"
    aria-label="ポートフォリを作品のスライダー"
  >
    <div class="splide__track">
      <div class="splide__list">
        {
          worksList.map((work) => {
            return (
              <article class="splide__slide works-slider-item">
                <div class="works-slider-item__inner">
                  <div class="works-slider-item__body">
                    <h3 class="works-slider-item__title">
                      <span>{work.title}</span>
                    </h3>
                    <a
                      href={`/works/${work.id}`}
                      class="works-slider-item__link"
                    >
                      詳しくみる
                    </a>
                  </div>
                  <div class="works-slider-item__image">
                    <Image
                      src={work.thumbnail?.url || ""}
                      alt={work.thumbnail?.alt || ""}
                      width={work.thumbnail?.width || 0}
                      height={work.thumbnail?.height || 0}
                    />
                  </div>
                </div>
              </article>
            );
          })
        }
      </div>
    </div>
    <div class="works-slider__controls">
      <button class="splide__toggle" type="button">
        <span class="splide__toggle__play">
          <svg
            class="play-icon"
            xmlns="http://www.w3.org/2000/svg"
            height="1.5em"
            viewBox="0 -960 960 960"
            width="1.5em"
            fill="#e3e3e3"
            aria-label="再生"
            ><path
              d="m380-300 280-180-280-180v360ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"
            ></path></svg
          >
        </span>
        <span class="splide__toggle__pause">
          <svg
            class="pause-icon"
            xmlns="http://www.w3.org/2000/svg"
            height="1.5em"
            viewBox="0 -960 960 960"
            width="1.5em"
            fill="#e3e3e3"
            aria-label="一時停止"
            ><path
              d="M360-320h80v-320h-80v320Zm160 0h80v-320h-80v320ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"
            ></path></svg
          >
        </span>
      </button>
      <ul class="splide__pagination"></ul>
      <div class="splide__arrows">
        <button class="splide__arrow splide__arrow--prev">
          <svg
            class="prev-icon"
            xmlns="http://www.w3.org/2000/svg"
            height="1em"
            viewBox="0 -960 960 960"
            width="1em"
            fill="#e3e3e3"
            ><path
              d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z"
            ></path></svg
          >
        </button>
        <button class="splide__arrow splide__arrow--next">
          <svg
            class="next-icon"
            xmlns="http://www.w3.org/2000/svg"
            height="1em"
            viewBox="0 -960 960 960"
            width="1em"
            fill="#e3e3e3"
            ><path
              d="M647-440H160v-80h487L423-744l57-56 320 320-320 320-57-56 224-224Z"
            ></path></svg
          >
        </button>
      </div>
    </div>
  </div>
</div>
<style lang="scss">
  @use "../../styles/mixin" as *;
  @use "../../styles/functions" as *;
  @use "../../styles/extends" as *;
  .works-slider-wrapper {
    margin-inline: -5vw;
    @include mq("lg") {
      max-width: 1240px;
      width: 100%;
      margin-inline: auto;
    }
  }
  .works-slider {
    & :global(.splide__slide .works-slider-item__inner) {
      opacity: 0.5;
      transform: scale(0.7);
      transition: all 1s ease;
      transform-origin: center center;
      position: relative;
    }
    & :global(.splide__slide.is-active) {
      z-index: 10;
    }
    & :global(.splide__slide.is-active .works-slider-item__title) {
      color: var(--white-color);
      &::before {
        transform: translateX(100%);
      }
    }
    & :global(.splide__slide.is-active .works-slider-item__inner) {
      opacity: 1;
      transform: scale(1);
      transform-origin: center center;
      &::after {
        opacity: 0;
        visibility: hidden;
      }
    }
  }
  .works-slider-item {
    position: relative;
    z-index: 1;
    padding: rem(12);
  }
  .works-slider-item__inner {
    position: relative;
    z-index: 1;
    flex-direction: column;
    border-radius: rem(8);
    box-shadow: 0 0 rem(12) 0 rgba(0, 0, 0, 0.3);

    &::after {
      z-index: 10;
      content: "";
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      background-color: rgba(0, 0, 0, 0.5);
      transition: opacity 0.3s, visibility 0.3s;
    }
  }
  .works-slider-item__body {
    position: absolute;
    bottom: 0;
    left: 0;
    z-index: 10;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
    padding: var(--spacing-md);
  }
  .works-slider-item__image {
    width: 100%;
    height: 100%;
    aspect-ratio: 3/2;
    overflow: hidden;
    background-color: var(--bg-secondary-color);
    > img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
      border-radius: rem(8);
    }
  }
  .works-slider-item__link {
    padding: 0.5em 1em;
    border-radius: rem(4);
    display: block;
    width: fit-content;
    text-align: center;
    font-weight: 700;
    font-size: var(--font-size-sm);
    transition:
      color 0.3s,
      background-color 0.3s;
    background-color: var(--text-primary);
    color: var(--white-color);
    z-index: 10;
    position: relative;
    @include mq("md") {
      padding: 0.75em 1.5em;
    }
    &:hover,
    &:focus-visible {
      background-color: var(--primary-color);
    }
  }
  .works-slider-item__title {
    background-color: var(--text-color);
    color: var(--text-color);
    font-size: var(--font-size-xl);
    padding: 0.25em 0.5em;
    width: fit-content;
    max-width: 100%;
    position: relative;
    z-index: 1;
    overflow: hidden;

    &::before,
    &::after {
      content: "";
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
      transition: transform 0.3s;
      transform: translateX(0%);
    }
    &::before {
      background-color: var(--white-color);
      z-index: 1;
      transition-delay: 0.2s;
    }
    &::after {
      z-index: -2;
      background-color: var(--text-primary);
      transition-delay: 0.6s;
    }
    > span {
      display: block;
      width: 100%;
      @include lineClamp(1);
    }
  }
  .works-slider__controls {
    margin-block-start: var(--spacing-md);
    margin-inline: auto;
    display: flex;
    align-items: center;
    width: 86%;
    gap: 0.5rem;
    @include mq("sm") {
      gap: 0.75rem;
      width: 74.8571%;
    }
    @include mq("md") {
      gap: 1rem;
      width: 56%;
    }
  }
  .splide__toggle {
    padding: 0;
    .pause-icon,
    .play-icon {
      transition: fill 0.3s;

      @include mq("sm") {
        width: 1.75rem;
      }
      @include mq("md") {
        width: 2rem;
      }
    }
    &:hover,
    &:focus-visible {
      .pause-icon,
      .play-icon {
        fill: var(--primary-color);
      }
    }
  }
  .splide__arrows {
    margin-inline-start: auto;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    @include mq("md") {
      gap: 0.5rem;
    }
    @include mq("lg") {
      gap: 0.75em;
    }
  }
  .splide__arrow {
    padding: rem(8);
    border: 2px solid var(--border-color);
    border-radius: 50%;
    transition:
      background-color 0.3s,
      border-color 0.3s;
    .prev-icon,
    .next-icon {
      transition: fill 0.3s;
      display: block;
      @include mq("md") {
        width: 1.25em;
      }
      @include mq("lg") {
        width: 1.5em;
      }
    }
    &:hover,
    &:focus-visible {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      .prev-icon {
        fill: var(--white-color);
      }
      .next-icon {
        fill: var(--white-color);
      }
    }
  }
  .splide__pagination {
    gap: 0.275rem;
    @include mq("md") {
      gap: 0.5rem;
    }
    & :global(.splide__pagination__page) {
      width: 1.25rem;
      height: 4px;
      background-color: var(--bg-secondary-color);
      border-radius: 4px;
      display: block;
      transition: background-color 0.3s;
      @include mq("sm") {
        width: 1.5rem;
      }
      @include mq("md") {
        height: 6px;
        width: 2rem;
      }
      &:hover,
      &:focus-visible {
        background-color: var(--text-primary);
      }
    }
    & :global(.splide__pagination__page.is-active) {
      background-color: var(--text-primary);
    }
  }
</style>
<script src="./slider.ts"></script>
